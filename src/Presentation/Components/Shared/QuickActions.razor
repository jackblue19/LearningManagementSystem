@namespace Presentation.Components.Shared
@using Microsoft.AspNetCore.Components

<div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="mb-4 flex items-center justify-between">
        <div>
            <h3 class="text-lg font-semibold text-slate-900">Quick actions</h3>
            <p class="text-xs text-slate-500">Jump straight into common workflows</p>
        </div>
        <span class="rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600">@ResolvedActions.Count()</span>
    </div>

    <div class="grid gap-3 md:grid-cols-2">
        @foreach (var action in ResolvedActions)
        {
            <a href="@action.Href" class="group relative flex flex-col gap-2 rounded-xl border border-slate-200 p-4 transition hover:-translate-y-0.5 hover:border-brand-300 hover:shadow-lg focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-600" data-quick-action="@action.Identifier">
                <div class="flex items-start justify-between gap-3">
                    <div>
                        <p class="text-sm font-semibold text-slate-900">@action.Title</p>
                        <p class="text-xs text-slate-500">@action.Description</p>
                    </div>
                    <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg @action.IconBackground text-white transition group-hover:scale-105">
                        @((MarkupString)action.IconMarkup)
                    </span>
                </div>
                @if (!string.IsNullOrWhiteSpace(action.Meta))
                {
                    <div class="text-xs font-medium text-slate-500">
                        @action.Meta
                    </div>
                }
            </a>
        }
    </div>
</div>

@code {
    private static readonly IReadOnlyList<QuickActionLink> TeacherActions = new[]
    {
        new QuickActionLink(
            Identifier: "manage-classes",
            Title: "Manage classes",
            Description: "Monitor attendance and adjust rosters",
            Href: "/Teachers/ManageClass",
            IconMarkup: "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M4 18h16M4 14h16m-7-4h7M4 6h7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>",
            IconBackground: "bg-brand-600",
            Meta: "Live roll call"),
        new QuickActionLink(
            Identifier: "register-student",
            Title: "Register student",
            Description: "Place learners into an upcoming cohort",
            Href: "/Teachers/RegisterClass",
            IconMarkup: "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-7 8a7 7 0 0 1 14 0\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>",
            IconBackground: "bg-emerald-500",
            Meta: "Seat availability updated"),
        new QuickActionLink(
            Identifier: "create-class",
            Title: "Create class",
            Description: "Set up a new section with instructor + room",
            Href: "/Teachers/CreateClass",
            IconMarkup: "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M12 4v16M4 12h16\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>",
            IconBackground: "bg-indigo-500",
            Meta: "Takes 2 minutes"),
        new QuickActionLink(
            Identifier: "plan-schedule",
            Title: "Plan schedule",
            Description: "Arrange sessions and share with learners",
            Href: "/Teachers/Schedule",
            IconMarkup: "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M8 7V4m8 3V4M4 9h16M5 9v9a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>",
            IconBackground: "bg-amber-500",
            Meta: "Syncs to calendar")
    };

    private IReadOnlyList<QuickActionLink> ResolvedActions =>
        CustomActions?.Any() == true
            ? CustomActions.ToList()
            : ResolveByContext(Context);

    private IReadOnlyList<QuickActionLink> ResolveByContext(string? context)
    {
        if (string.IsNullOrWhiteSpace(context))
        {
            return TeacherActions;
        }

        return context.Trim().ToLowerInvariant() switch
        {
            "admin" => new[]
            {
                new QuickActionLink("admin-users", "Manage users", "Provision or suspend platform access", "/Admin/Users", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-7 8a7 7 0 0 1 14 0\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-brand-600", "Role governance"),
                new QuickActionLink("admin-reports", "Generate report", "Compile weekly performance insights", "/Admin/Reports", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M4 19h16M4 5h16M9 9v6m6-6v6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-sky-500", "CSV & PDF"),
                new QuickActionLink("admin-billing", "Reconcile payments", "Review invoices and outstanding balances", "/Admin/Payments", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M21 12a9 9 0 1 1-9-9\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path d=\"M21 3 12 12\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-emerald-500", "Finance ops"),
                new QuickActionLink("admin-announce", "Post announcement", "Share updates with the entire organisation", "/Admin/Announcements", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M5 15v4a2 2 0 0 0 2 2h2m10-8v-2a2 2 0 0 0-2-2h-1.171a2 2 0 0 1-1.414-.586l-2.829-2.828A2 2 0 0 0 10.172 3H9a2 2 0 0 0-2 2v9\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-amber-500", "Notify everyone"),
            },
            "centre" => new[]
            {
                new QuickActionLink("centre-rooms", "Allocate rooms", "Balance classroom usage and availability", "/CentreManagement/Rooms", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M4 5h16v14H4z\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path d=\"M9 5v14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-brand-600", "Utilisation 84%"),
                new QuickActionLink("centre-availability", "Review availability", "Check teacher and room overlaps", "/CentreManagement/Availability", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M3 5h18M3 12h18M3 19h18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-emerald-500", "6 conflicts"),
                new QuickActionLink("centre-maintenance", "Log maintenance", "Flag facilities issues for action", "/CentreManagement/Maintenance", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"m4 20 4-4M4 4l16 16\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-amber-500", "Response in 2h"),
                new QuickActionLink("centre-insights", "Download insights", "Pull utilisation and attendance dashboards", "/CentreManagement/Reports", "<svg class=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"><path d=\"M7 10v10M12 4v16m5-8v8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>", "bg-sky-500", "Scheduled export"),
            },
            _ => TeacherActions,
        };
    }

    [Parameter]
    public string? Context { get; set; }

    [Parameter]
    public IEnumerable<QuickActionLink>? CustomActions { get; set; }

    public record QuickActionLink(
        string Identifier,
        string Title,
        string Description,
        string Href,
        string IconMarkup,
        string IconBackground,
        string? Meta);
}